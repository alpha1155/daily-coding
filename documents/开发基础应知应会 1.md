[toc]
# 1 环境安装
官方网站下载所需软件
## 1.1 sap jdk
询问同事安装sap jdk
## 1.2 idea
激活码如下失效后询问leo 配置格式 询问wade 或其余开发同事


## 1.3 git
全局设置 用户名邮箱
git config --global user.name "你的名字"
git config --global user.email "你的邮箱"

## 1.4 postman、Bruno
推荐使用postman免费版

## 1.5 Mermaid 编辑器
须掌握Mermaid 编辑流程图
[Mermaid](https://mermaidjs.github.io/)

## 1.6 权限申请 

### 1.6.1 Jenkins& dashboard日志
询问 chang li 

### 1.6.2 GitHub 权限申请
询问 hailing

### 1.6.3 QA CI 相关测试系统权限
询问 Shirley Yu、Mering Liu

## 1.7 redis 下载
官网安装即可 需要设置启动时的用户名密码并写入到启动文件中

## 1.8 rabbitMq下载
官网安装即可 
## 1.8 Dbserver 下载
官网安装即可 类似于navicat
**Edition就选Generic，Host，Port 在数据库文件db driver中找到devst1的host，user，可以看出来其中的username、passwrod和dev-st1 3的环境文件一致，所以之后如果启动项目要换数据链接，在开发环境文件中改动就行**

Port就是固定443
db配置可在BAS上查看权限找changli申请。或询问其余后端同事

## 1.10 maven配置
更改maven的setting配置

``` xml
<settings xmlns="http://maven.apache.org/SETTINGS/1.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd">
   <!--  Id: com.sap:artifactory:1.0.0:settings.xml  -->
   <mirrors>
      <mirror>
         <id>mirror1</id>
         <url>https://int.repositories.cloud.sap/artifactory/build-milestones/</url>
         <mirrorOf>*,!artifactory</mirrorOf>
      </mirror>
   </mirrors>
   <servers>
        <server>
            <id>artifactory</id>
         </server>
    </servers>
   <profiles>
      <profile>
         <id>release.build</id>
         <pluginRepositories>
            <pluginRepository>
               <id>artifactory</id>
               <url>https://int.repositories.cloud.sap/artifactory/build-releases/</url>
            </pluginRepository>
         </pluginRepositories>
         <repositories>
            <repository>
               <id>artifactory</id>
               <url>https://common.repositories.cloud.sap/deploy-releases-hyperspace-maven/</url>
            </repository>
         </repositories>
         <properties>
            <tycho.disableP2Mirrors>true</tycho.disableP2Mirrors>
            <tycho.localArtifacts>ignore</tycho.localArtifacts>
         </properties>
      </profile>
      <profile>
         <id>milestone.build</id>
         <pluginRepositories>
            <pluginRepository>
               <id>artifactory</id>
               <url>https://int.repositories.cloud.sap/artifactory/build-milestones/</url>
            </pluginRepository>
         </pluginRepositories>
         <repositories>
            <repository>
               <id>artifactory</id>
               <url>https://common.repositories.cloud.sap/deploy-releases-hyperspace-maven/</url>
            </repository>
         </repositories>
         <properties>
            <tycho.disableP2Mirrors>true</tycho.disableP2Mirrors>
            <tycho.localArtifacts>ignore</tycho.localArtifacts>
         </properties>
      </profile>
      <profile>
         <id>snapshot.build</id>
         <pluginRepositories>
            <pluginRepository>
               <id>artifactory</id>
               <url>https://int.repositories.cloud.sap/artifactory/build-snapshots/</url>
            </pluginRepository>
         </pluginRepositories>
         <repositories>
            <repository>
               <id>artifactory</id>
               <url>https://common.repositories.cloud.sap/deploy-releases-hyperspace-maven/</url>
            </repository>
         </repositories>
         <properties>
            <tycho.disableP2Mirrors>true</tycho.disableP2Mirrors>
            <tycho.localArtifacts>ignore</tycho.localArtifacts>
         </properties>
      </profile>
      <profile>
         <id>sonar</id>
         <activation>
            <activeByDefault>true</activeByDefault>
         </activation>
         <properties>
            <sonar.host.url>https://sonar.tools.sap</sonar.host.url>
            <tycho.disableP2Mirrors>true</tycho.disableP2Mirrors>
            <tycho.localArtifacts>ignore</tycho.localArtifacts>
         </properties>
      </profile>
   </profiles>
   <activeProfiles>
      <activeProfile>snapshot.build</activeProfile>
   </activeProfiles>
   <pluginGroups>
      <pluginGroup>com.sap.ldi</pluginGroup>
   </pluginGroups>
</settings>
```


# 2 本地启动
## 2.1启动准备
### 2.1.1 准备启动参数
需要变更redis 启动用户名与密码
vcap.services.ems-redis.credentials.password= 你的redism密码
可以使用idea插件EnvFile去指定配置文件
```
## 2.2 本地启动配置变更
### ems-lib-common\security\src\main\java\com\sap\csc\ems\security\util\JWTAnalyzer.java
``` java
/**  
 * Project Name:security * File Name:JWTAnalyzer.java * Description: Analyzer for jwt token. * Copyright: Copyright (c) 2017 * Company:SAP * * @author SAP  
 * @date Sep 26, 2017 11:18:45 AM  
 * @version  
 * @see  
 * @since  
 */  
package com.sap.csc.ems.security.util;  
  
import java.net.URL;  
import java.text.ParseException;  
import java.time.Instant;  
import java.util.Arrays;  
import java.util.HashMap;  
import java.util.HashSet;  
import java.util.List;  
import java.util.Map;  
import java.util.Map.Entry;  
import java.util.Objects;  
import java.util.Set;  
  
import org.apache.commons.collections4.CollectionUtils;  
import org.apache.commons.lang3.StringUtils;  
import org.slf4j.Logger;  
import org.slf4j.LoggerFactory;  
import org.springframework.beans.factory.annotation.Autowired;  
import org.springframework.security.authentication.BadCredentialsException;  
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;  
import org.springframework.security.core.Authentication;  
import org.springframework.security.core.context.SecurityContext;  
import org.springframework.security.core.context.SecurityContextHolder;  
import org.springframework.security.oauth2.jwt.Jwt;  
import org.springframework.security.oauth2.server.resource.authentication.JwtAuthenticationToken;  
import org.springframework.stereotype.Component;  
  
import com.nimbusds.jwt.JWT;  
import com.nimbusds.jwt.JWTParser;  
import com.sap.csc.ems.defaults.dto.TenantDto;  
import com.sap.csc.ems.defaults.service.ITenantService;  
import com.sap.csc.ems.security.config.internal.LocalMockUserConfiguration;  
import com.sap.csc.ems.security.constants.CfEnvConstants;  
import com.sap.csc.ems.security.constants.SecurityConstants;  
import com.sap.csc.ems.security.constants.UaaAttributesConstants;  
import com.sap.csc.ems.security.exception.InvalidTokenException;  
import com.sap.csc.ems.security.model.JWTToken;  
import com.sap.csc.ems.security.model.JWTTokenModel;  
import com.sap.csc.ems.security.util.AuthInfoCache.AuthInfo;  
  
import jakarta.annotation.Nullable;  
import jakarta.annotation.PostConstruct;  
  
@Component  
public class JWTAnalyzer  
{  
    private static final Logger log = LoggerFactory.getLogger(JWTAnalyzer.class);  
  
    private static JWTAnalyzer jwtAnalyzer;  
  
    @Autowired  
    private ITenantService iTenantService;  
  
    @Autowired(required = false) // not development environment will be null  
    private LocalMockUserConfiguration localMockUser;  
  
    private static final List<String> UAA_ATTRIBUTES_NEED_BE_FORMAT_COLLECTION = Arrays.asList(  
        //Entitlement - Customer  
        UaaAttributesConstants.ENTL_READ_CUSTOMER_ID, UaaAttributesConstants.ENTL_READ_CUSTOMER_GROUP,  
        UaaAttributesConstants.ENTL_CHANGE_CUSTOMER_ID, UaaAttributesConstants.ENTL_CHANGE_CUSTOMER_GROUP,  
        //Entitlement - Offering  
        UaaAttributesConstants.ENTL_READ_PRODUCT_ID, UaaAttributesConstants.ENTL_READ_PRODUCT_CATEGORY,  
        UaaAttributesConstants.ENTL_CHANGE_PRODUCT_ID, UaaAttributesConstants.ENTL_CHANGE_PRODUCT_CATEGORY,  
        //Entitlement - Distributor  
        UaaAttributesConstants.ENTL_READ_DISTRIBUTOR_ID, UaaAttributesConstants.ENTL_CHANGE_DISTRIBUTOR_ID,  
        //Entitlement - Third Party  
        UaaAttributesConstants.ENTL_READ_THIRD_PARTY_ID, UaaAttributesConstants.ENTL_CHNG_THIRD_PARTY_ID,  
        //Folder - Customer  
        UaaAttributesConstants.FOLDER_CUSTOMERID, UaaAttributesConstants.FOLDER_CUSTOMERGRP,  
        UaaAttributesConstants.FOLDER_CHNG_CUSTOMERID, UaaAttributesConstants.FOLDER_CHNG_CUSTOMERGRP,  
        //Contact Person - Customer  
        UaaAttributesConstants.CONTACTS_READ_CUSTOMER_GROUP, UaaAttributesConstants.CONTACTS_READ_CUSTOMER_ID,  
        UaaAttributesConstants.CONTACTS_CHANGE_CUSTOMER_GROUP, UaaAttributesConstants.CONTACTS_CHANGE_CUSTOMER_ID  
       );  
  
    private JWTAnalyzer()  
    {  
        //avoid warning  
    }  
  
    /**  
     * Title: getIssTenant <br/>  
     * <br/>  
     * Description: get tenant readable id like 'dev-st1', the value represent the 'customer subdomain' concept of BTP  
     *     * @return tenant  
     */    @Nullable  
    public static String getIssTenant()  
    {  
        //        final JWTToken token = JWTTokenModelWithScopes();  
        //        if (token != null) {        //            return token.getTenantId();        //        }        //        final AuthInfo info = AuthInfoCache.authInfoCache.get();        //        if (null != info) {        //            return info.getTenantIss();        //        }        //        if (log.isErrorEnabled()) {        //            log.error("JWTAnalyzer.getIssTenant: auth == null");        //        }        //        return null;        return "dev-st1";  
    }  
  
    /**  
     * Title: getZoneId <br/>  
     * <br/>  
     * Description: get zone uuid from claims.zid, it's the 'Tenant ID' which shows in customer cockpit  
     *     * @return zone id  
     */    @Nullable  
    public static String getZoneId()  
    {  
        //        final JWTTokenModel m = getJWTTokenModel();  
        //        if (m != null) {        //            return m.getZid();        //        }        //        final AuthInfo info = AuthInfoCache.authInfoCache.get();        //        if (null != info) {        //            return info.getTenantId();        //        }        //        return null;        return "ca4fc015-e45d-4b6b-8bcb-74eedb1debbb";  
    }  
  
  
    /**  
     * Title: getJWTTokenModel <br/>  
     * <br/>  
     * Description: get jwt token  
     *     * @return jwt token  
     */    public static JWTTokenModel getJWTTokenModel()  
    {  
        return JWTTokenModelWithScopes();  
    }  
  
    /**  
     * Title: JWTTokenModelWithScopes <br/>  
     * <br/>  
     * Description: generate jwt token  
     *     * @return jwt token  
     */    public static JWTToken JWTTokenModelWithScopes() // NOSONAR  
    {  
        return getJWTTokenModelFrom(getCurrentJwt());  
    }  
  
    public static JWTToken getJWTTokenModelFrom(String tokenValue)  
    {  
        return getJWTTokenModelFrom(Jwt.withTokenValue(tokenValue).build());  
    }  
  
    public static JWTToken getJWTTokenModelFrom(Jwt jwt)  
    {  
        // in the application-local environment, this field will be filled (if provided)  
  
        if (jwtAnalyzer != null && jwtAnalyzer.localMockUser != null) {  
            return jwtAnalyzer.localMockUser;  
        }  
  
        final JWTToken jwtTokenModel = new JWTToken();  
  
        if (jwt == null) {  
            return null;  
        }  
  
        String tenantId = null;  
  
        // try to get tenant from zdn  
        final Map<String, Object> extAttr = jwt.getClaimAsMap(SecurityConstants.EXT_ATTR);  
        if (extAttr != null) {  
            final Object zdn = extAttr.get(SecurityConstants.ZDN);  
            if (zdn != null) {  
                tenantId = zdn.toString();  
            }  
            // set sub-account id  
            final Object subAccountId = extAttr.get(SecurityConstants.SUB_ACCOUNT_ID);  
            if (subAccountId != null) {  
                jwtTokenModel.setSubAccountId(subAccountId.toString());  
            }  
        }  
  
        final String iss = jwt.getClaimAsString(SecurityConstants.ISS);  
        if (iss != null) {  
            URL url = null;  
            try {  
                url = new URL(iss);  
                final String host = url.getHost();  
                final int posOfDot = host.trim().indexOf(SecurityConstants.DOT);  
                tenantId = host.substring(0, posOfDot);  
            }  
            catch (final Exception e) {  
                // do nothing  
            }  
  
        }  
  
        if (tenantId != null) {  
            jwtTokenModel.setTenantId(tenantId);  
        }  
  
        jwtTokenModel.setZid(jwt.getClaim(SecurityConstants.ZONE_ID));  
        final Instant exp = jwt.getClaimAsInstant(SecurityConstants.EXPIRATION);  
        if (exp != null) {  
            jwtTokenModel.setExp(exp.getEpochSecond());  
        }  
  
        jwtTokenModel.setUserName(jwt.getClaim(SecurityConstants.USER_NAME));  
        jwtTokenModel.setEmail(jwt.getClaim(SecurityConstants.EMAIL));  
        jwtTokenModel.setFamilyName(jwt.getClaim(SecurityConstants.FAMILY_NAME));  
        jwtTokenModel.setGivenName(jwt.getClaim(SecurityConstants.GIVEN_NAME));  
        jwtTokenModel.setUserId(jwt.getClaim(SecurityConstants.USER_ID));  
        jwtTokenModel.setScopes(new HashSet<>(jwt.getClaimAsStringList(SecurityConstants.SCOPES)));  
  
        //----------------------------UAA attributes under current user----------------------------------  
        final Map<String, Object> plainAttributes = jwt.getClaimAsMap(SecurityConstants.ATTRIBUTES);  
        if (plainAttributes != null)  
        {  
            final Map<String, Set<String>> attrMap = new HashMap<>();  
            for (Entry<String, Object> entry : plainAttributes.entrySet())  
            {  
                final Object value = entry.getValue();  
                final Set<String> attributes = new HashSet<>();  
                if (value instanceof List)  
                {  
                    final List<String> items = (List<String>) value;  
                    if (items.contains(SecurityConstants.STAR))  
                    {  
                        //if one uaa attribute contains "*", it means this uaa attribute can display all  
                        attributes.clear();  
                        attributes.add(SecurityConstants.STAR);  
                    }  
                    else  
                    {  
                        attributes.addAll(items);  
                    }  
                }  
  
                // special handle UAA attributes  
                if (UAA_ATTRIBUTES_NEED_BE_FORMAT_COLLECTION.contains(entry.getKey()))  
                {  
                    attrMap.put(entry.getKey(), specialSymbolConversion(attributes));  
                }  
                else  
                {  
                    attrMap.put(entry.getKey(), attributes);  
                }  
  
            }  
            if (log.isInfoEnabled())  
            {  
                log.info("UAA attributes from JWT token which after special handle are: {}", attrMap);  
            }  
            jwtTokenModel.setAttributes(attrMap);  
        }  
        //----------------------------UAA attributes under current user----------------------------------  
  
        return jwtTokenModel;  
    }  
  
    /**  
     * Title: getCurrentJwt <br/>  
     * <br/>  
     * Description: Check if current authentication is as expected.  
     *     * @return Jwt  
     * @throws BadCredentialsException  
     *             If authentication type is incorrect.     */    private static Jwt getCurrentJwt()  
    {  
        final SecurityContext ctx = SecurityContextHolder.getContext();  
        if (ctx == null) {  
            return null;  
        }  
        final Authentication auth = ctx.getAuthentication();  
        if (auth == null) {  
            return null;  
        }  
        if (SecurityConstants.ANONYMOUS_USER.equals(auth.getName())) {  
            return null;  
        }  
        if (auth instanceof JwtAuthenticationToken) {  
            return ((JwtAuthenticationToken) auth).getToken();  
        }  
        // the basic auth context need to get zid/tenantIss  
        if ((auth instanceof UsernamePasswordAuthenticationToken) && AuthInfoCache.authInfoCache.get() != null) {  
            return null;  
        }  
        else {  
            throw new BadCredentialsException(SecurityConstants.MSG_NULL_TOKEN);  
        }  
    }  
  
    /**  
     * Title: getFullName <br/>  
     * <br/>  
     * Description: get full name of user  
     *     * @return full name which combined given name and family name or ""  
     */    public static String getFullName()  
    {  
//        String fullName;  
//        final JWTToken jwtToken = JWTTokenModelWithScopes();  
//        if (jwtToken == null) {  
//            AuthInfo authInfo = AuthInfoCache.authInfoCache.get();  
//            if (authInfo != null)  
//            {  
//                return authInfo.getFullName();  
//            }  
//            return StringUtils.EMPTY;  
//        }  
//  
//        //1. Get full name from JWT.  
//        //given name  
//        final String givenName = null == jwtToken.getGivenName() ? StringUtils.EMPTY : jwtToken.getGivenName();  
//        //family name  
//        final String familyName = null == jwtToken.getFamilyName() ? StringUtils.EMPTY : jwtToken.getFamilyName();  
//  
//        fullName = givenName + " " + familyName;  
//        //2. If full name is null in JWT, get it from technique user.  
//        if (StringUtils.isEmpty(fullName.trim()))  
//        {  
//            final TenantDto tenant = jwtAnalyzer.iTenantService.findByTenantId(getIssTenant());  
//            // check tenant  
//            if (null == tenant)  
//            {  
//                throw new SecurityException("Tenant not found.");  
//            }  
//            // check tenant technical user  
//            fullName = tenant.getUserName();  
//            if (StringUtils.isEmpty(fullName))  
//            {  
//                //3. If the tenant does not have a technical user, use a default user name - "{tenantID}_admin"  
//                //It will be used to populate the "CreatedBy"/"LastChangedBy" in the API/Transport  
//                fullName = Objects.toString(getIssTenant(), StringUtils.EMPTY).concat("_admin");  
//            }  
//        }  
//        return fullName.length() > 100 ? fullName.substring(0, 99) : fullName;  
        return "Shengxiang Yin";  
    }  
  
    /**  
     * Description: get current login user name from token     *     * @return user name or "" when no token setting  
     */    public static String getUserName()  
    {  
        final JWTToken jwtToken = JWTTokenModelWithScopes();  
        if (jwtToken == null) {  
            return StringUtils.EMPTY;  
        }  
        return null == jwtToken.getUserName() ? StringUtils.EMPTY : jwtToken.getUserName();  
    }  
  
    /**  
     * Title: getEmail <br/>  
     * <br/>  
     * Description: get user email, default is ""  
     *     * @return email or ""  
     */    public static String getEmail()  
    {  
//        final JWTToken jwtToken = JWTTokenModelWithScopes();  
//        if (jwtToken == null) {  
//            return StringUtils.EMPTY;  
//        }  
//        return null == jwtToken.getEmail() ? StringUtils.EMPTY : jwtToken.getEmail();  
        return "shengxiang.yin01@sap.com";  
    }  
  
    /**  
     * Title: specialSymbolConversion Description: special symbol conversion     *     * @param setAttrs all UAA attributes value  
     * @return UAA attributes value after special handling  
     */    private static Set<String> specialSymbolConversion(Set<String> setAttrs)  
    {  
        final Set<String> setStrings = new HashSet<>();  
  
        for (String setAttr : setAttrs)  
        {  
            //Locate the first colon  
            int index = setAttr.indexOf(UaaAttributesConstants.SPLIT_COLON);  
            int count = 0;  
            if (index != -1)  
            {  
                count = 1; //only one colon  
                final String subString = setAttr.substring(index + 1);  
  
                //Locate the second colon  
                index = subString.indexOf(UaaAttributesConstants.SPLIT_COLON);  
                if (index != -1)  
                {  
                    count = 2; // more than one colon  
                }  
            }  
  
            //The string contains more than one colon and does not continue to check  
            if (count > 1)  
            {  
                //if more than one colon, replaced all by $null  
                setAttr = UaaAttributesConstants.EMPTY_NULL;  
            }  
            //Processing for the string contains one colon  
            else if (count == 1)  
            {  
                //start with ":"  
                if (setAttr.startsWith(UaaAttributesConstants.SPLIT_COLON))  
                {  
                    setAttr = UaaAttributesConstants.EMPTY_NULL;  
                }  
                //end with ":"  
                else if (setAttr.endsWith(UaaAttributesConstants.SPLIT_COLON))  
                {  
                    setAttr = setAttr.substring(0, setAttr.length() - 1).trim();  
                }  
                else if ("*:*".equals(setAttr))  
                {  
                    setAttr = UaaAttributesConstants.ALL;  
                }  
                //contains "$null","$blank"  
                else  
                {  
                    final String[] sub = setAttr.split(UaaAttributesConstants.SPLIT_COLON);  
                    //$null:S/4->$null  *:$null->$null  A:$blank->$null  
                    if (UaaAttributesConstants.EMPTY_NULL.equals(sub[0].trim()) || UaaAttributesConstants.EMPTY_NULL.equals(sub[1].trim())  
                            || UaaAttributesConstants.BLANK_NULL.equals(sub[1].trim()))  
                    {  
                        setAttr = UaaAttributesConstants.EMPTY_NULL;  
                    }  
                    //$blank:S/4->$blank  
                    else if (UaaAttributesConstants.BLANK_NULL.equals(sub[0].trim()))  
                    {  
                        setAttr = UaaAttributesConstants.BLANK_NULL;  
                    }  
                    //XXX:* -> XXX  
                    else if (!UaaAttributesConstants.ALL.equals(sub[0].trim()) && !UaaAttributesConstants.EMPTY_NULL.equals(sub[0].trim())  
                            && !UaaAttributesConstants.BLANK_NULL.equals(sub[0].trim()) && UaaAttributesConstants.ALL.equals(sub[1].trim()))  
                    {  
                        setAttr = sub[0].trim();  
                    }  
                }  
            }  
            setStrings.add(setAttr);  
        }  
  
        final Set<String> setRetStr = new HashSet<>();  
  
        if (CollectionUtils.isNotEmpty(setStrings))  
        {  
            for (final String value : setStrings)  
            {  
                if (1 == setStrings.size())  
                {  
                    setRetStr.add(value);  
                }  
                //"*" has the highest priority  
                else if (setStrings.contains(UaaAttributesConstants.ALL))  
                {  
                    setRetStr.add(UaaAttributesConstants.ALL);  
                    return setRetStr;  
                }  
                //"$null" has the lowest priority  
                else if (setStrings.size() > 1 && !UaaAttributesConstants.EMPTY_NULL.equals(value))  
                {  
                    setRetStr.add(value);  
                }  
            }  
        }  
        return setRetStr;  
    }  
  
    /**  
     * Title: getPlanFromToken <br/>  
     * <br/>  
     * Description: Get plan from jwt token, copied from SAPOfflineTokenServicesCloud  
     *     * @param accessToken token string  
     * @return java.lang.String  
     */    public static String getPlanFromToken(String accessToken)  
    {  
        JWT jwt;  
  
        try {  
            jwt = JWTParser.parse(accessToken);  
        }  
        catch (final ParseException e) {  
            log.warn("Invalid token.", e);  
            throw new InvalidTokenException("Invalid token.", e);  
        }  
  
        String clientId;  
        try {  
            clientId = (String) jwt.getJWTClaimsSet().getClaim("client_id");  
        }  
        catch (final Exception e) {  
            log.warn("Invalid token. Attribute 'client_id' missing.", e);  
            throw new InvalidTokenException("Invalid token. Attribute 'client_id' missing.", e);  
        }  
        String plan;  
        if (clientId.contains("!t")) {  
            plan = CfEnvConstants.APPLICATION_PLAN;  
        }  
        else if (clientId.contains("!b")) {  
            plan = CfEnvConstants.BROKER_PLAN;  
        }  
        else if (clientId.contains("!s")) {  
            plan = CfEnvConstants.SYSTEM_PLAN;  
        }  
        else if (clientId.contains("!i")) {  
            plan = CfEnvConstants.SPACE_PLAN;  
        }  
        else if (clientId.contains("!u")) {  
            plan = CfEnvConstants.DEVUSER_PLAN;  
        }  
        else {  
            plan = CfEnvConstants.DEFAULT_PLAN;  
        }  
  
        log.info("Access token of service plan [{}] received.", plan);  
  
        return plan;  
    }  
  
    /**  
     * Title: setiTenantService <br/>  
     * <br/>  
     * Description: set service  
     *     * @param iTenantService tenant service  
     */    public void setiTenantService(ITenantService iTenantService)  
    {  
        this.iTenantService = iTenantService;  
    }  
  
    /**  
     * Title: init <br/>  
     * <br/>  
     * Description: initial service  
     */    @PostConstruct  
    public void init()  
    {  
        jwtAnalyzer = this;  
        jwtAnalyzer.localMockUser = this.localMockUser;  
        jwtAnalyzer.iTenantService = this.iTenantService;  
    }  
}
```
### ems-lib-common\security\src\main\java\com\sap\csc\ems\togglz\constants\EmsToggleFeatureEnum.java
``` java
package com.sap.csc.ems.togglz.constants;  
  
import com.sap.csc.ems.security.util.JWTAnalyzer;  
import com.sap.csc.ems.togglz.EmsToggleFeatureProvider;  
import org.apache.commons.lang3.StringUtils;  
import org.slf4j.Logger;  
import org.slf4j.LoggerFactory;  
import org.togglz.core.Feature;  
import org.togglz.core.context.FeatureContext;  
  
/**  
 * @author Drummond  
 * @since 2020/9/19 10:50 AM  
 */public enum EmsToggleFeatureEnum  
{  
    EF_E2EV2("EF-E2EV2");  
  
    private final Logger logger = LoggerFactory.getLogger(this.getClass());  
  
    private final String name;  
  
    EmsToggleFeatureEnum(String name)  
    {  
        this.name = name;  
    }  
  
    public String getName()  
    {  
        return name;  
    }  
  
    public boolean isEnabled()  
    {  
        String tenantIss = JWTAnalyzer.getIssTenant();  
        return isEnabled(tenantIss);  
    }  
  
    public boolean isEnabled(String tenantIss)  
    {  
//        if (StringUtils.isEmpty(tenantIss))  
//        {  
//            return false;  
//        }  
//  
//        boolean enabled = false;  
//        Feature feature = EmsToggleFeatureProvider.INSTANCE.getFeature(this.getName(), tenantIss);  
//        if (null == feature)  
//        {  
//            logger.error("Tenant {} and feature {} did not find a corresponding 'Feature' entity. There may be a potential issue. "//  
//                + "Please check the 'tenantId' of the 'Security.Tenant' table in the Admin DB with the tenant subdomain of the BTP.", tenantIss,  
//                this.getName());  
//        }  
//        else  
//        {  
//            enabled = FeatureContext.getFeatureManager().isActive(feature);  
//        }  
//  
//        return enabled;  
        return true;  
    }  
}
```


### ems-lib-common\amqp\src\main\java\com\sap\csc\ems\starter\amqp\AmqpMessageReceiver.java

``` java showLineNumbers
package com.sap.csc.ems.starter.amqp;  
  
import java.lang.reflect.InvocationTargetException;  
import java.lang.reflect.Method;  
  
import org.slf4j.Logger;  
import org.slf4j.LoggerFactory;  
import org.springframework.amqp.core.Message;  
import org.springframework.amqp.core.MessageProperties;  
  
import com.fasterxml.jackson.databind.JavaType;  
import com.rabbitmq.client.Channel;  
import com.sap.csc.ems.asyncprocess.constants.AsyncProcess;  
import com.sap.csc.ems.multitenancy.DataSourceHolder;  
import com.sap.csc.ems.multitenancy.DynamicDBDeploy;  
import com.sap.csc.ems.redis.util.RedisLockUtil;  
import com.sap.csc.ems.security.util.AuthInfoCache;  
import com.sap.csc.ems.starter.common.MessageHeaders;  
import com.sap.csc.ems.starter.common.MessageReceiver;  
import com.sap.csc.ems.starter.common.constants.MessageBrokerConstants;  
import com.sap.csc.ems.starter.common.exception.MQRequeueException;  
import com.sap.hcp.cf.logging.common.Fields;  
import com.sap.hcp.cf.logging.common.LogContext;  
import com.sap.hcp.cf.logging.common.request.HttpHeaders;  
  
class AmqpMessageReceiver  
{  
    private final Logger logger = LoggerFactory.getLogger(AmqpMessageReceiver.class);  
      
    private MessageReceiver<?> mr;  
    private Method method;  
    private JavaType parameterType;  
    private ContentTypeMessageConverter converter;  
    private RedisLockUtil redisLockUtil;  
  
    public AmqpMessageReceiver(MessageReceiver<?> mr, Method method, JavaType parameterType, ContentTypeMessageConverter converter, RedisLockUtil redisLockUtil)  
    {  
        this.mr = mr;  
        this.method = method;  
        this.parameterType = parameterType;  
        this.converter = converter;  
        this.redisLockUtil = redisLockUtil;  
    }  
  
    public void onMessage(Message message, Channel channel) throws Exception  
    {  
        MessageProperties properties = message.getMessageProperties();  
  
        long deliveryTag = properties.getDeliveryTag();  
  
        try  
        {  
            MessageHeaders headers = new MessageHeaders();  
  
            String correlationId = (String) properties.getHeaders().get(HttpHeaders.CORRELATION_ID.getName());  
  
            if (correlationId != null)  
            {  
                LogContext.initializeContext(correlationId);  
            }  
  
            String zoneId = (String) properties.getHeaders().get(MessageBrokerConstants.X_EMS_TENANT_ZONE_ID);  
  
            if (zoneId != null)  
            {  
                headers.setZoneId(zoneId);  
//                DynamicDBDeploy.setDataSource(zoneId);  
                LogContext.add(Fields.TENANT_ID, zoneId);  
            }  
            else  
            {  
                logger.error("NOTICE: the message receiver {} received message without zoneId (tenantId) information, it will lost tenant information and lost data isolation", this.mr.getClass().getName());  
            }  
  
            String iss = (String) properties.getHeaders().get(MessageBrokerConstants.X_EMS_TENANT_ISS);  
  
            if (iss != null)  
            {  
                headers.setIss(iss);  
                LogContext.add(Fields.TENANT_SUBDOMAIN, iss);  
            } else {  
                logger.error("NOTICE: the message receiver {} received message without tenantIss (tenant subdomain) information, it will lost tenant information and log context", this.mr.getClass().getName());  
            }  
  
            String xInboundTransaction = (String) properties.getHeaders().get(AsyncProcess.X_EMS_INBOUND_TRANSACTION);  
  
            if (xInboundTransaction != null)  
            {  
                headers.setxInboundTransaction(xInboundTransaction);  
            }  
  
            String xOutboundTransaction = (String) properties.getHeaders().get(AsyncProcess.X_EMS_OUTBOUND_TRANSACTION);  
  
            if (xOutboundTransaction != null)  
            {  
                headers.setxOutboundTransaction(xOutboundTransaction);  
            }  
  
            Object xTraceId = properties.getHeaders().get(AsyncProcess.X_EMS_TRACE_ID);  
  
            if (xTraceId != null)  
            {  
                headers.setxTraceId(xTraceId.toString());  
            }  
              
            String userEmail = (String) properties.getHeaders().get(MessageBrokerConstants.X_EMS_USER_EMAIL);  
  
            if (userEmail != null)  
            {  
                headers.setUserEmail(userEmail);  
            }  
              
            String userFullName = (String) properties.getHeaders().get(MessageBrokerConstants.X_EMS_USER_FULLNAME);  
            if (userFullName != null)  
            {  
                headers.setUserFullName(userFullName);  
            }  
              
            Object authorization = properties.getHeaders().get(MessageBrokerConstants.X_EMS_AUTHORIZATION);  
              
            if (authorization != null)  
            {  
                headers.setAuthorization(authorization.toString());  
            }  
            headers.setHeaders(properties.getHeaders());  
  
            // set auth info cache for processor usage  
            AuthInfoCache.put(iss, zoneId, userFullName, null == authorization ? null : authorization.toString());  
  
            method.invoke(this.mr, converter.convert(message, parameterType), headers);  
              
            channel.basicAck(deliveryTag, true);  
        }  
        catch (Exception e)  
        {  
            if(e instanceof InvocationTargetException)  
            {  
                Throwable targetException = ((InvocationTargetException) e).getTargetException();  
                if(null != targetException && (targetException instanceof MQRequeueException || targetException.getCause() instanceof MQRequeueException))  
                {  
                    //Do nothing, if Catch this kind of exception, the messages will re-push into MQ  
                    logger.error("Catch MQ requeue exceptions in AMQP Message Receiver", e);  
                    channel.basicNack(deliveryTag, true, true);  
                    throw new MQRequeueException("AMQP receiver get MQ requeue exceptions, then re-push into queue.");  
                }  
            }  
              
            logger.error("Invoke business logic of ({} : {}) failed: ", mr.getClass(), method.getName(), e);  
            channel.basicAck(deliveryTag, true);  
        }  
        finally  
        {  
            // remove auth info cache finally  
            AuthInfoCache.remove();  
            DataSourceHolder.clearDataSource();  
            redisLockUtil.unlockWithCache();  
        }  
    }  
}
```
### 需要指定启动的相关文件pom中的版本号
举例 
``` XML
<parent>  
    <groupId>com.sap.csc.ems</groupId>  
    <artifactId>ems-parent</artifactId>  
    <version>[3.1.0,3.2.0)</version>  
</parent>
<properties>  
    <java.version>17</java.version>  
    <ems.version>[3.1.0,3.2.0)</ems.version>  
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>  
</properties>
变更为
 <parent>  
    <groupId>com.sap.csc.ems</groupId>  
    <artifactId>ems-parent</artifactId>  
    <version>3.1.0</version>  
</parent>
<properties>  
    <java.version>17</java.version>  
    <ems.version>3.1.0</ems.version>  
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>  
</properties>
```
## 2.3 本地启动顺序
先启动 eureka 其余按依赖顺序启动

# 3 服务部署
## 3.1 dev环境 
### 准备
阅读并完成How To install Cloud Foundry And Deploy The Project 文件并获取相应权限

### 数据库
使用git bash 切换至ems-cap路径下并获取CFD权限后
使用shell脚本部署
<font color=red>注意：该脚本仅能用于部署des-st1环境服务。想部署其他环境需要在脚本68行切换tenantID 即
curl -X PUT https://ems-onboarding-admin-service-develop.cfapps.sap.hana.ondemand.com/callback/v1.0/multi-tenancy/{tenantID} -H "Authorization: Bearer ${token}"</font>

``` bash showLineNumbers
#!/bin/bash  
#set -x  
print_error()  
{  
  echo -e "\033[31m $1 \033[0m" }  
  
print_info()  
{  
  echo -e "\033[32m $1 \033[0m"}  
  
  
  
current_org=$(eval echo `cf target | grep -i "org" | cut -d : -f 2`)  
current_space=$(eval echo `cf target | grep -i "space" | cut -d : -f 2`)  
  
print_info "##############################Org/Space#############################"  
print_info "###### Deploy org is [${current_org}], Deploy space is [${current_space}] ######"  
print_info "##############################Org/Space#############################"  
  
if [[ "${current_org}x" != "emsdevx" ]]; then  
    #statements  
    print_error "Current org is [${current_org}], you have to switch to [emsdev] first"  
    exit -1  
fi  
  
if [[ "${current_space}x" != "developx" ]]; then  
    #statements  
    print_error "Current space is [${current_space}], you have to switch to [develop] first"  
    exit -1  
fi  
  
  
print_info "1. build scripts"  
cds build  
if [ $? -ne 0 ]; then  
    print_error "build scripts failed" && exit -1  
fi  
  
print_info "2. replace separator from . to ::"  
sed -i -e 's/com\.sap\.ems\.db\.common\.data\./com\.sap\.ems\.db\.common\.data::/g' -e 's/com\.sap\.ems\.db\.config\.data\./com\.sap\.ems\.db\.config\.data::/g' -e 's/com\.sap\.ems\.db\.entitlement\.data\./com\.sap\.ems\.db\.entitlement\.data::/g' -e 's/com\.sap\.ems\.db\.integration\.data\./com\.sap\.ems\.db\.integration\.data::/g' -e 's/com\.sap\.ems\.db\.masterdata\./com\.sap\.ems\.db\.masterdata::/g' -e 's/com\.sap\.ems\.db\.status\.data\./com\.sap\.ems\.db\.status\.data::/g' -e 's/com\.sap\.ems\.db\.synonyms\./com\.sap\.ems\.db\.synonyms::/g' gen/db/src/gen/*.hdb*  
sed -i -e 's/com\.sap\.ems\.db\.entitlement\.data\./com\.sap\.ems\.db\.entitlement\.data\::/g' gen/db/src/*.hdb*  
sed -i -e 's/com\.sap\.ems\.db\.common\.data\./com\.sap\.ems\.db\.common\.data::/g' -e 's/com\.sap\.ems\.db\.config\.data\./com\.sap\.ems\.db\.config\.data::/g' -e 's/com\.sap\.ems\.db\.entitlement\.data\./com\.sap\.ems\.db\.entitlement\.data::/g' -e 's/com\.sap\.ems\.db\.integration\.data\./com\.sap\.ems\.db\.integration\.data::/g' -e 's/com\.sap\.ems\.db\.masterdata\./com\.sap\.ems\.db\.masterdata::/g' -e 's/com\.sap\.ems\.db\.status\.data\./com\.sap\.ems\.db\.status\.data::/g' -e 's/com\.sap\.ems\.db\.synonyms\./com\.sap\.ems\.db\.synonyms::/g' gen/db/src/*.hdb*  
  
if [ $? -ne 0 ]; then  
    print_error "replace separator failed" && exit -1  
fi  
  
#delete additional configuration to avoid side effect  
print_info "3. modify manifest.yml"  
sed -i '4,11d' gen/db/manifest.yml  
if [ $? -ne 0 ]; then  
    print_error "modify manifest.yml failed" && exit -1  
fi  
  
print_info "4. push to cloud env"  
cd ./gen/db && cf push   
if [ $? -ne 0 ]; then  
    print_error "push to cloud failed" && exit -1  
fi  
  
print_info "5. get access token"  
json=$(curl -X POST 'https://emsdev.authentication.sap.hana.ondemand.com/oauth/token?grant_type=client_credentials' -H 'Authorization: Basic c2ItY3NjZW1zLWNlbnRyYWwtdWFhIXQyOTEyOjVBWWxFb1IwanowZUtTbGowT0lPWStoQmVoOD0=')  key="access_token"  
token=$(echo "${json}" | awk -F"[,:}]" '{for(i=1;i<=NF;i++){if($i~/'${key}'\042/){print $(i+1)}}}' | tr -d '"' | sed -n ${num}p)  
print_info "6. start deploy"  
curl -X PUT https://ems-onboarding-admin-service-develop.cfapps.sap.hana.ondemand.com/callback/v1.0/multi-tenancy/ca4fc015-e45d-4b6b-8bcb-74eedb1debbb -H "Authorization: Bearer ${token}"  
rm -rf ../../gen  
echo '!!!done!!!'
```
### 服务
<font color=red>注意：dev环境部署服务之前需要优先恢复本地变更的相关配置文件</font>

 1. 使用maven install lib-common
 2. 使用maven package 需要部署的service 
 3. 获取CFD 权限
 4. 切换到需要部署的文件路径下使用命令 cf push

## 3.2 res&patch&ci
询问changli 获取权限后通过 Jenkins部署
注意：ondemand 部署不会重新打包（即lib-common 变更不会生效），lib-common存在变更需要通过build-deploy打包

# 4 开发规范
## 4.1 设计规范
[参考详细设计模板](C:\Users\C5393557\Documents\开发必知必会文档\详细涉及模板.md)

## 4.2 代码规范
<font color=red>无用代码及时删除</font>
### 4.2.1 命名规范
<font color=red>原则：命名足够meaningful</font>
基本follow 阿里开发规范，方法动词开头描述清楚，controller interface implement 均需要遵守该规范。

### 4.2.2 变量定义
<font color=red>注意: 与view 表接口相互对应的实体字段应设置为String，设置为枚举时无法使用QueryBuilder框架进行查询</font>
其余follow阿里开发规范

### 4.2.3 开发格式

#### 4.2.3.1 代码块格式
示例 
``` java
if (flag)  
{  
... 
}

try  
{  
	...
}
catch (Excetiion e)  
{  
	....
}
```

#### 4.2.3.2 I18nMessageKeys 格式
正常空格
``` java
String EXAMPLE = "EXAMPLE";
```
相应的i18n.properties中无需空格
``` properties
EXAMPLE=EXAMPLE;
```

#### 4.2.4 开发注意
必须遵循面向对象设计基本原则
 1.   单一职责原则（一个类只负责一件事，只有一个引起它变化的原因）
 2.   开放封闭原则（对于扩展开放的，对于修改封闭的）
 3.   里氏替换原则（子类型（subtype）必须能够替换掉它们的基类型（basetype）同时程序的功能保持不变）
 4.   接口隔离原则（不应该强制客户代码依赖它不需要的方法）
 5.   依赖倒置原则（高层模块不应该依赖底层模块，两者都应该依赖抽象）

<font color=red>设计阶段即需要考虑业务逻辑实现与代码结构是否可采用设计模式(创建型、结构型、行为型)</font>
其余遵循阿里开发规范。
<font color=red>原则上须保证代码可读性，自解释性。</font>


#### 4.2.4.1 设计模式使用示例
[设计模式 | 菜鸟教程](https://www.runoob.com/design-pattern/design-pattern-tutorial.html)
#### 策略模式
参考external 服务的IExportTemplateService 模板导出实现。



####  模板模式

参考transport 服务的AbstractExecutionHistoryService模板实现。



#### 责任链模式
参考mgmt服务的ProvisioningProcess 的创建验证规则配置。
ProvisioningProcessDefinitionDtoValidation.class

#### 其余待增加

#### 4.2.5 开发框架使用

##### 4.2.5.1 入参验证

简单验证使用@Valid @Valid @NotNull @Size 等注解实现

复杂验证需要一个RulesConfiguration配置实现规则 并且需要一个BusinessValidatorV2的子类并重写checkRule方法写入校验规则

详细使用案例可参考mgmt服务



##### 4.2.5.2 接口权限控制

使用注解@PreAuthorize做控制。

权限控制方式如项目代码所示。一般来说使用同service下接口权限即可。特殊情况在design meeting时在做询问。



##### 4.2.5.2 报错与断言

external接口断言与报错使用 AssertionV2与EMSExceptionFactory.createV2ByMessage等V2字样的方法

内部业务逻辑报错使用Assertion与EMSExceptionFactory.createByMessage 等不带V2字样的方法

异常信息均需要使用I18nMessageKeys做国际化处理。

> [!CAUTION]
>
> 需要注意的是 两者根本区别在于所使用的异常处理器不同。service inboundV2 的EMSInboundProcessorV2ServiceExceptionHandler 继承自common 包的EMSBaseExceptionHandlerV2会专门处理携带V2字样的异常。
>
> 其他service 会继承EMSBaseExceptionHandler 并在其中自定义异常处理方法



##### 4.2.5.3 Query相关

仅适用于UI页面查询。后端自己查询使用JPA repository查询。

###### 4.2.5.3.1 QueryCriteria 

分页查询入参

参数为排序条件 sorts 查询条件 filters 分页条件 paging 以及需要返回的字段acquireColums

> [!IMPORTANT]
>
> 须注意传入的字段名称需要与QueryBuilder.Create(Entity.class)中的Entity属性名称保持一致。否则QueryBuilder阶段会报错。



###### 4.2.5.3.2 QueryCriteriaValidator

查询入参校验。validate方法需要传入被允许返回的字段集合，被允许使用的过滤字段，以及被允许使用的排序操作符。

会分别校验结果字段集合，过滤条件集合，排序操作符集合以及分页参数



###### 4.2.5.3.2 QueryBuilder

一般情况下是实现分页查询场景的，也可用于查询全部结果集并返回。通常需要指定Entity。

Entity需要使用JPA注解@Table指定相应的表名或视图名称。并使用@Entity注解

查询参数则是经过验证的QueryCriteria参数

通常情况下。

分页查询 使用QueryBuilder.queryPage 

返回全部l使用QueryBuilder.queryList

处理数据返回到前端请看下一章节。[4.2.5.4 接口返回](#4.2.5.4 接口返回)



> [!CAUTION]
>
> 查询必须指定返回字段即设置acquireColumns，如果无需前端传入则需要后端指定。



> [!WARNING]
>
> 注意使用QueryBuilder查询时。如果需要变更相关Entity属性名称，修改完毕Entity属性名称之后必须用重洗生成被修改字段的Getter Setter方法。原因在于QueryBuilder.class 606行会以字段名去寻找相应getset方法进行后续sql拼接与赋值操作



##### 4.2.5.4 接口返回

使用ResponseEntity与其中方法返回,使用MessageUtil组装。

一般会使用ResponseEntity.ok(data).

部分异步API会需要返回特殊状态码时使用如下代码。

```java
return new ResponseEntity<>(successMessage, HttpStatus.ACCEPTED);
```

分页查询组装返回参数可使用PageResponseUtil.convertPage返回。（此方法支持提供convert方法来转换返回DTO）

非分页查询也可使用PageResponseUtil.convertList返回。

> [!WARNING]
>
> 需要注意的是使用场景。使用上述两个方法入参不可以使用不可变List 比如stream流的toList方法等。会导致异常产生。



##### 4.2.5.5 inbound接口实现与模板导出

> [!CAUTION]
>
> [!CAUTION]
>
> 原则上不允许对外接口直接抛出technical exception。不允许对外报500. 异常抛出参考 [4.2.5.2 报错与断言](#4.2.5.2 报错与断言)



###### 4.2.5.5.1 @EnableInboundTransaction

使用注解 @EnableInboundTransaction 可自动记录inbound接口monitor call详情。

如果不希望该接口的请求记录被查出需在monitor 服务中AbstractFilterDataSourceFactory的noLogAPICodes添加相应的API名称



###### 4.2.5.5.2 @EnableAsyncProcess

使用注解 @EnableAsyncProcess (EnableAsyncProcessAspect)可自动实现异步触发。本质是通过MQ触发。需要指定相应的receiver。



###### 4.2.5.5.3 @AsyncProcessSupport 

todo



###### 4.2.5.5.4  入参json模板导出

入参json模板导出为InboundMappingTypePredeliverData.csv增加行记录后，在External服务中InterfaceEnum增加接口名称与实现IExportTemplateService 提供导出模板

实现reprocess 在external 服务AbstractLogInterfaceFacade中有模板方法。



4.2.5.5.5  outboundLog 

todo



##### 4.2.5.6 JPA使用

参考官方文档[Spring Data JPA :: Spring Data JPA](https://docs.spring.io/spring-data/jpa/reference/)



##### 4.2.5.7 feature toggle

新增功能可不加feature toggle 开关控制
原有功能上做修改必须要增加feature toggle开关控制
示例

``` java
//when toggle switch on  
if (EnterpriseFeatureUtils.enterpriseFeatureEnabled(EnterpriseFeatureConstants.EF_TRANSPORT_ACROSS_TENANT)) 
{  
	business logic
}else
{
    business logic
}
```

增加一个toggle feature开关需要在数据库central DB与代码里均增加相关信息具体参考EF-PHASED-SAVED开关。



##### 4.2.5.8 RESTFUL API命名

[RESTful API 教程 | 菜鸟教程](https://www.runoob.com/restfulapi/restful-api-tutorial.html)



##### 4.2.5.9 UT功能要写全面完整
功能开发完毕后，需要增加相应/test/java路径下的UT。
UT需要cover每个新增或修改的功能代码行。



##### 4.2.5.10 及时沟通

详细设计阶段与PO、前后端合作同事及时沟通，解决需求本身或需求实现等相关问题。



## 4.3 push之前

> [!CAUTION]
>
>   1. <font color=red>格式化自己所修改的代码 </font>
>   2. <font color=red>验证相关的UT是否通过 </font>
>   3. <font color=red>验证本地是否可以成功启动服务</font>
>   4. <font color=red>Comment格式 [CSCEMS-XXXXX] XXXX</font>
>   5. 检查commit文件中的warning报错并尝试修复


# 5 merge PR
除了bug之外每个sprint合代码窗口期为第二周

 1. 5.1 准备自测报告准备相关代码UT
已经联调：从数据准备开始，完成完整功能自测截图报告。
未联调：使用postman等工具自测。
 2. 邀请相关同事review
 3. 通过相关APItest

## 5.1 pipeline报错处理
  1. 检查自己PR格式。
  2. 检查是否修改了lib-common但是没有优先合入。
  3. 检查自己所修改service是否存在UT跑不过。
### 5.1.1 日志查看
![git页面报错入口](C:\Users\C5393557\Documents\开发必知必会文档\imgas\PR日志查看\git页面报错入口.png)

![详情页报错入口](C:\Users\C5393557\Documents\开发必知必会文档\imgas\PR日志查看\详情页报错入口.png)



![Jenkins页面报错入口](C:\Users\C5393557\Documents\开发必知必会文档\imgas\PR日志查看\Jenkins页面报错入口.png)

